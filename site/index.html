<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Lex Base</title>
  <style>
    :root {
    --toc-w: 280px;
    --gutter-w: 28px;
    --gutter-bg: #f7f7f8;
    --gutter-border: #e5e7eb;
    --gutter-hover: #def7e0;
    --bg: #ffffff;
    --ink: #111827;
    --muted: #6b7280;
    --line: #e5e7eb;
    --brand: #1f2937;
    --accent: #0ea5e9;
    }

    html, body { height: 100%; margin: 0; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      display: flex;
      flex-direction: column;
      background: var(--bg);
    }

    /* Header */
    header {
      border-bottom: 1px solid var(--line);
      padding: 10px 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 50;
    }

    /* 搜索栏 */
    #searchbar { display:flex; align-items:center; gap:8px; flex: 1; }
    #q { 
      flex: 1; 
      min-width: 260px; 
      padding: 10px 14px;
      font-size: 16px;
      line-height: 1.3;
    }

    #q:focus-visible {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(14,165,233,.15);
      outline: 0;
    }
    #hit-info { margin-left: auto; order: 2; font-variant-numeric: tabular-nums; }
    #prev-hit, #next-hit { order: 3; }

    /* 搜索提示 */
    /* tip bar unify with gutter */
    #search-tip{
      font-size:12px; color:#334155;
      padding:6px 12px 10px 12px;
      border-bottom:1px solid var(--gutter-border);
      background: var(--gutter-bg);
      position: sticky; top: 48px; z-index: 40;
    }

    /* 面包屑 */
    #breadcrumb {
      color: #0366d6;
      padding: 6px 12px;
      max-width: 1100px;
      font-size: 12px;
    }
    #breadcrumb a { color:#0366d6; text-decoration:none; }
    #breadcrumb a:hover { text-decoration:underline; }
    .crumb-sep::before { content: '›'; color: #aaa; margin: 0 4px; }

    /* 布局 */
    main {
      display: grid;
      grid-template-columns: var(--toc-w) var(--gutter-w) 1fr;
      grid-template-areas: "toc gutter content";
    }
    body.sb-collapsed main {
      grid-template-columns: 0 var(--gutter-w) 1fr;
      grid-template-areas: "toc gutter content";
    }
    aside#toc   { grid-area: toc; }
    #gutter     { grid-area: gutter; }
    section     { grid-area: content; }
    body.sb-collapsed aside#toc { overflow: hidden; pointer-events: none; }

    /* TOC 栏 */
    aside#toc {
      border-right: 1px solid var(--line);
      height: calc(100vh - 110px);
      position: sticky;
      top: 88px;
      overflow: auto;
      background: #fff;
    }
    .toc-toolbar {
      display:flex; align-items:center; justify-content:space-between;
      gap: 8px;
      padding:8px 10px; border-bottom:1px solid #f3f3f3;
      position: sticky; top:0; background:#fff; z-index:10;
    }
    .toc-section-title{ font-weight:600; padding:8px 10px; }
    #filetree, #page-toc { padding: 6px 10px; }

    /* 文件树 */
    .dir .header { display:flex; align-items:center; gap:6px; cursor:pointer; padding:4px 2px; border-radius:6px; }
    .dir .children { padding-left: 12px; }
    a.file { display:block; padding:3px 2px; text-decoration:none; color:#222; border-radius:6px; }
    a.file:hover { background: #f5f5f5; }
    #filetree a.active{ background:#f3f4f6; border-radius:6px; }

    /* 本页目录 */
    #page-toc .toc-row{ display:flex; align-items:center; }
    #page-toc .toc-fold{ flex-shrink:0; }

    /* v0.28 统一 caret 风格（文件树 + 本页目录） */
    #filetree .caret,
    #page-toc .toc-fold{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.6em;        /* 更大可点的命中区 */
      height: 1.8em;
      font-size: 16px;
      line-height: 1;
      user-select: none;
      cursor: pointer;
      color: var(--muted); /* SVG 使用 currentColor，保持与文字一致 */
    }

    /* 叶子行：不响应点击，但保持对齐占位 */
    #page-toc .toc-fold.leaf{
      opacity: 0;
      pointer-events: none;
    }

    /* 让 SVG 不拦截事件，点击始终命中 .toc-fold 本身 */
    #page-toc .toc-fold svg,
    #page-toc .toc-fold path { pointer-events: none; }

    /* hover 高亮（原有 hover 行为保留） */
    #filetree .caret:hover,
    #page-toc .toc-fold:hover{
      color: var(--ink);
    }

    /* 本页目录文字样式 —— 统一到与文件树一致的字号 */
    #page-toc a{
      flex:1 1 auto;
      display:inline-block;
      padding-left:4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size:16px;     /* 由 14px 调整为 16px */
      line-height:1.5;    /* 与文件树观感更接近 */
      color:#222;
      text-decoration:none;
      border-radius:6px;
    }

    #page-toc a.active,
    #page-toc a.locked { background:#e8f3fe; }

    mark.search-hit { background:#fff3a8; padding:0 2px; }
    mark.search-current { background:#ffd54f; outline: 1px solid #ff9800; }

    /* gutter 折叠按钮 */
    #gutter{
    height:100%;
    border-left:1px solid var(--gutter-border);
    background:var(--gutter-bg);
    display:flex; justify-content:center;
    transition: background .15s ease;
    }
    #gutter:hover{ background: var(--gutter-hover); }

    #toc-toggle{
    position: sticky; top: calc(50vh - 36px);
    width: calc(var(--gutter-w) - 6px);
    height:72px; display:grid; place-items:center;
    border:1px solid var(--gutter-border);
    background:#fff; color:#374151; border-radius:10px;
    box-shadow:0 1px 2px rgba(0,0,0,.05); cursor:pointer;
    }
    #toc-toggle:hover{ background:#fff; }
    #toc-toggle:focus-visible { outline: 2px solid #4f46e5; }

    /* 正文区 */
    section { height: calc(100vh - 110px); overflow: auto; }
    #viewer { padding: 16px 24px; max-width: 1100px; font-size:17px; line-height:1.65; }
    
    /* 段落的底部间距：约半行，细密但不拥挤 */
    #viewer p { margin: 0 0 0.825em; } /* 0.825 = 1.65 / 2 */

    #viewer h1{ font-size:24px; margin:1.2em 0 0.6em; }
    #viewer h2{ font-size:22px; margin:1.1em 0 0.5em; }
    #viewer h3{ font-size:20px; margin:1em 0 0.5em; }
    #viewer h4{ font-size:18px; margin:0.9em 0 0.4em; }
    #viewer h5, #viewer h6{
      font-size:17px;
      margin:0.8em 0 0.3em;
      font-weight:bold;
    }
    #viewer h1, #viewer h2, #viewer h3, #viewer h4, #viewer h5, #viewer h6 { scroll-margin-top: 90px; }

    /* 段落后紧跟标题时，强制拉开等于一行行高的间距 */
    #viewer p + h1,
    #viewer p + h2,
    #viewer p + h3,
    #viewer p + h4,
    #viewer p + h5,
    #viewer p + h6 {
    margin-top: 1.8em !important; /* 等于正文 line-height，观感稳 */
    }

    /* 高亮 */
    .md-section.section-highlight{
      background:#fff8c4;
      border-radius:4px;
      padding:2px 0;
    }
    #viewer .section-highlight{ 
      background:#fff8c4; 
      transition: background-color .2s ease; 
    }

    @media (max-width: 880px) {
      :root { --toc-w: 280px; }
    }

    /* icon 按钮 */
    .icon-btn{
      border:1px solid var(--line);
      padding:10px 14px;
      background:#fff;
      border-radius:6px;
      cursor:pointer;
      min-width:32px;
      text-align:center;
      font-size:16px;
    }
    .icon-btn:hover{ background:#f9fafb; }

  

/* v0.27 — Page TOC per-level indentation (class-based) & compact mode */
#page-toc { --indent-step: 12px; }
#page-toc:not(.compact) a.lvl-2 { padding-left: calc(var(--indent-step) * 1); }
#page-toc:not(.compact) a.lvl-3 { padding-left: calc(var(--indent-step) * 2); }
#page-toc:not(.compact) a.lvl-4 { padding-left: calc(var(--indent-step) * 3); }
#page-toc:not(.compact) a.lvl-5 { padding-left: calc(var(--indent-step) * 4); }
#page-toc:not(.compact) a.lvl-6 { padding-left: calc(var(--indent-step) * 5); }
/* compact 模式直接顶格：在 JS 给 #page-toc 添加 .compact 即可 */
#page-toc.compact a[class^="lvl-"] { padding-left: 0 !important; }

/* resizable gutter */
#gutter { cursor: col-resize; }
body.resizing, body.resizing * { cursor: col-resize !important; user-select: none !important; }
#toc-toggle { cursor: pointer; }

/* v0.28 移动端适配[E3] mobile drawer */
@media (max-width: 768px){
  :root { --toc-w: 70vw; }
  main { grid-template-columns: 1fr; grid-template-areas: "content"; }
  #gutter { display:none; }
  aside#toc{
    position: fixed; left:0; top:88px;
    width: var(--toc-w); height: calc(100vh - 88px);
    transform: translateX(-100%); transition: transform .2s ease;
    z-index: 1000; box-shadow:2px 0 6px rgba(0,0,0,.08); background:#fff;
  }
  body.drawer-open aside#toc{ transform: translateX(0); }
  #drawer-btn{
    margin-right:8px; width:32px; height:32px;
    border:1px solid var(--gutter-border); background:#fff; border-radius:6px;
    display:inline-grid; place-items:center;
  }
  #drawer-scrim{ display:none; }
  body.drawer-open #drawer-scrim{
    display:block; position: fixed; inset:0;
    background: rgba(0,0,0,.25); z-index: 900;
  }
}

</style>
</head>
<body>
  <header>
    <strong>My Lex Base</strong>
    <div id="searchbar">
      <input id="q" type="search" placeholder="在当前文档内搜索（支持多命中）…" />
      <button id="prev-hit" class="icon-btn" title="上一个匹配">▲</button>
      <button id="next-hit" class="icon-btn" title="下一个匹配">▼</button>
      <span id="hit-info">0 / 0</span>
    </div>
  </header>

  <div id="search-tip">
  <button id="drawer-btn" class="icon-btn" title="目录" aria-label="目录">≡</button>
  提示：目前仅支持“当前文档内”的全文搜索；请先在左侧选择一个文档。
  </div>
  <div id="breadcrumb"></div>
  <div id="drawer-scrim" hidden></div>

  <main>
    <aside id="toc">
      <div class="toc-toolbar">
        <strong id="toc-title">文档/目录</strong>
        <div class="toc-toolbar-right">
          <button id="toc-mode" title="在 文件树 / 本页目录 之间切换">切换视图</button>
          <button id="toc-expand-all" title="展开/收起全部">展开全部</button>
        </div>
      </div>
      <div id="filetree"></div>
      <div id="page-toc" style="display:none;"></div>
    </aside>

    <div id="gutter">
      <button id="toc-toggle" aria-controls="toc" aria-expanded="true" title="收起目录">❮</button>
    </div>

    <section>
      <div id="results"></div>
      <article id="viewer"></article>
    </section>
  </main>

  <script src="assets/marked.min.js"></script>
  <script src="assets/app.js"></script>
</body>
</html>
